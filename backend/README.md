# ğŸ”¥ çŸ¥ä¹çƒ­æ¦œåç«¯æœåŠ¡

åŸºäº Node.js + Express + SQLite çš„åç«¯æœåŠ¡ï¼Œæä¾›çŸ¥ä¹çƒ­æ¦œçš„æŠ“å–ã€å­˜å‚¨å’ŒæŸ¥è¯¢åŠŸèƒ½ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- âœ… **æ‰‹åŠ¨æŠ“å–** - API è§¦å‘æŠ“å–çŸ¥ä¹çƒ­æ¦œ
- âœ… **è‡ªåŠ¨æŠ“å–** - å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ‰§è¡Œï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰
- âœ… **SQLite å­˜å‚¨** - æœ¬åœ°æ•°æ®åº“ï¼Œæ— éœ€ Git æäº¤
- âœ… **å†å²æŸ¥è¯¢** - æŸ¥è¯¢æ‰€æœ‰å†å²è®°å½•
- âœ… **ç»Ÿè®¡ä¿¡æ¯** - æ•°æ®ç»Ÿè®¡å’ŒçŠ¶æ€
- âœ… **CORS æ”¯æŒ** - å…è®¸å‰ç«¯è·¨åŸŸè°ƒç”¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼ˆå·²åˆ›å»ºé»˜è®¤é…ç½®ï¼‰ï¼š

```bash
# æœåŠ¡å™¨ç«¯å£
PORT=3000

# å®šæ—¶ä»»åŠ¡ Cron è¡¨è¾¾å¼ï¼ˆæ¯30åˆ†é’Ÿï¼‰
CRON_SCHEDULE=0 */30 * * * *

# å…è®¸çš„å‰ç«¯åŸŸå
ALLOWED_ORIGINS=http://localhost:5173,https://geeker-wang.github.io
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆéœ€è¦å®‰è£… nodemonï¼‰
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

æœåŠ¡å¯åŠ¨åè®¿é—®ï¼š`http://localhost:3000/api/health`

## ğŸ“¡ API æ¥å£

### 1. å¥åº·æ£€æŸ¥
```
GET /api/health
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "status": "ok",
  "timestamp": 1704067200000,
  "version": "1.0.0"
}
```

### 2. æ‰‹åŠ¨æŠ“å–
```
POST /api/fetch
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "æŠ“å–æˆåŠŸ",
  "data": {
    "id": "snapshot-1704067200000",
    "timestamp": 1704067200000,
    "formattedTime": "2024-01-01 12:00:00",
    "count": 30,
    "items": [
      {
        "id": "123456",
        "title": "çƒ­æ¦œæ ‡é¢˜",
        "description": "çƒ­æ¦œæè¿°",
        "heat": 1250000,
        "url": "https://www.zhihu.com/question/123456",
        "timestamp": 1704067200000,
        "fetchTime": "2024-01-01 12:00:00",
        "rank": 1
      }
    ]
  }
}
```

### 3. è·å–å†å²è®°å½•
```
GET /api/history?limit=50&offset=0
```

**å‚æ•°**ï¼š
- `limit` (å¯é€‰): è¿”å›æ•°é‡ï¼Œé»˜è®¤ 50
- `offset` (å¯é€‰): åç§»é‡ï¼Œé»˜è®¤ 0

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": "snapshot-1704067200000",
      "timestamp": 1704067200000,
      "formattedTime": "2024-01-01 12:00:00",
      "count": 30,
      "items": [...]
    }
  ]
}
```

### 4. è·å–æœ€æ–°è®°å½•
```
GET /api/latest
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "id": "snapshot-1704067200000",
    "timestamp": 1704067200000,
    "formattedTime": "2024-01-01 12:00:00",
    "count": 30,
    "items": [...]
  }
}
```

### 5. è·å–ç»Ÿè®¡ä¿¡æ¯
```
GET /api/stats
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "totalSnapshots": 10,
    "totalItems": 300,
    "firstRecord": 1704067200000,
    "lastRecord": 1704153600000,
    "firstRecordTime": "2024-01-01 12:00:00",
    "lastRecordTime": "2024-01-02 12:00:00"
  }
}
```

### 6. æ¸…ç©ºå†å²è®°å½•
```
POST /api/clear-history
Content-Type: application/json

{
  "confirm": "YES_CLEAR_ALL"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "å†å²è®°å½•å·²æ¸…ç©º"
}
```

## ğŸ“ æ•°æ®åº“ç»“æ„

### hot_snapshots è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| snapshot_id | TEXT | å¿«ç…§å”¯ä¸€ID |
| timestamp | INTEGER | æ—¶é—´æˆ³ |
| formatted_time | TEXT | æ ¼å¼åŒ–æ—¶é—´ |
| count | INTEGER | æ¡ç›®æ•°é‡ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

### hot_items è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| snapshot_id | TEXT | å…³è”å¿«ç…§ID |
| item_id | TEXT | çƒ­æ¦œæ¡ç›®ID |
| title | TEXT | æ ‡é¢˜ |
| description | TEXT | æè¿° |
| heat | INTEGER | çƒ­åº¦ |
| url | TEXT | é“¾æ¥ |
| timestamp | INTEGER | æ—¶é—´æˆ³ |
| fetch_time | TEXT | æŠ“å–æ—¶é—´ |
| rank | INTEGER | æ’å |

## ğŸ”§ æŠ€æœ¯æ ˆ

- **Express** - Web æ¡†æ¶
- **SQLite3** - åµŒå…¥å¼æ•°æ®åº“
- **Node-cron** - å®šæ—¶ä»»åŠ¡
- **Axios** - HTTP è¯·æ±‚
- **CORS** - è·¨åŸŸæ”¯æŒ

## ğŸ“Š æ•°æ®æµç¨‹

```
å®šæ—¶ä»»åŠ¡ / æ‰‹åŠ¨è§¦å‘
       â†“
  æŠ“å–çŸ¥ä¹ API
       â†“
  æ•°æ®è½¬æ¢éªŒè¯
       â†“
  ä¿å­˜åˆ° SQLite
       â†“
  è¿”å›ç»™å‰ç«¯
```

## ğŸš€ éƒ¨ç½²å»ºè®®

### æ–¹å¼ 1: VPS éƒ¨ç½²ï¼ˆæ¨èï¼‰
```bash
# 1. ä¸Šä¼ ä»£ç åˆ° VPS
# 2. å®‰è£…ä¾èµ–
npm install

# 3. å®‰è£… PM2
npm install -g pm2

# 4. å¯åŠ¨æœåŠ¡
pm2 start server.js --name zhihu-hot

# 5. è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

### æ–¹å¼ 2: Docker éƒ¨ç½²
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

### æ–¹å¼ 3: äº‘å‡½æ•°
éœ€è¦ä¿®æ”¹ä¸º Serverless å…¼å®¹ç‰ˆæœ¬ï¼ˆæ”¯æŒå®šæ—¶è§¦å‘ï¼‰

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç«¯å£å ç”¨**: ç¡®ä¿ç«¯å£æœªè¢«å ç”¨ï¼Œæˆ–ä¿®æ”¹ `.env` ä¸­çš„ `PORT`
2. **CORS é…ç½®**: æ ¹æ®å®é™…å‰ç«¯åŸŸåæ›´æ–° `ALLOWED_ORIGINS`
3. **å®šæ—¶ä»»åŠ¡**: æœåŠ¡å™¨å¿…é¡»ä¿æŒè¿è¡Œæ‰èƒ½æ‰§è¡Œå®šæ—¶ä»»åŠ¡
4. **æ•°æ®åº“å¤‡ä»½**: å®šæœŸå¤‡ä»½ `data/zhihu-hot.db` æ–‡ä»¶
5. **ç£ç›˜ç©ºé—´**: ç›‘æ§æ•°æ®åº“æ–‡ä»¶å¤§å°ï¼ŒåŠæ—¶æ¸…ç†æ—§æ•°æ®

## ğŸ› å¸¸è§é—®é¢˜

**Q: æŠ“å–å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–çŸ¥ä¹ API æ˜¯å¦æœ‰å˜åŒ–

**Q: å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œï¼Ÿ**
A: ç¡®ä¿æœåŠ¡å™¨æ—¶é—´æ­£ç¡®ï¼Œä¸”æœåŠ¡æŒç»­è¿è¡Œ

**Q: æ•°æ®åº“æ–‡ä»¶åœ¨å“ªï¼Ÿ**
A: é»˜è®¤åœ¨ `./data/zhihu-hot.db`

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ—¥å¿—è¾“å‡ºæˆ–è”ç³»å¼€å‘è€…ã€‚

---

*ç‰ˆæœ¬: 1.0.0*
*æ›´æ–°æ—¶é—´: 2026-01-08*
