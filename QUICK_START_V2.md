# ğŸš€ å¿«é€Ÿå¼€å§‹ - V2 æ–°æ¶æ„

## ğŸ“‹ ä¸€åˆ†é’Ÿäº†è§£

**æ–°æ¶æ„ä¼˜åŠ¿**:
- âœ… æ— éœ€ Git æäº¤ï¼Œæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨
- âœ… è‡ªåŠ¨å®šæ—¶æŠ“å–ï¼ˆæ— éœ€é¡µé¢æ‰“å¼€ï¼‰
- âœ… æ›´å¿«çš„å“åº”é€Ÿåº¦
- âœ… å®Œæ•´çš„ API æ¥å£

---

## ğŸ¯ éƒ¨ç½²æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šéƒ¨ç½²åç«¯ï¼ˆ5åˆ†é’Ÿï¼‰

#### 1. å‡†å¤‡æœåŠ¡å™¨
```bash
# æ¨èé…ç½®
- é˜¿é‡Œäº‘ ECS / è…¾è®¯äº‘ CVM
- 1æ ¸ 1GB å†…å­˜
- Ubuntu 20.04+
```

#### 2. å®‰è£… Node.js
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

#### 3. ä¸Šä¼ å¹¶éƒ¨ç½²
```bash
# ä¸Šä¼ åç«¯ä»£ç 
cd backend
npm install
./deploy.sh  # é€‰æ‹© 1 (PM2)

# æˆ–ä½¿ç”¨ Docker
./deploy.sh  # é€‰æ‹© 2 (Docker)
```

#### 4. é…ç½®åå‘ä»£ç†ï¼ˆæ¨èï¼‰
```bash
# å®‰è£… Nginx
sudo apt install nginx

# åˆ›å»ºé…ç½®
sudo nano /etc/nginx/sites-available/zhihu-hot

# å†…å®¹ï¼š
server {
    listen 80;
    server_name your-domain.com;
    location / {
        proxy_pass http://localhost:3000;
    }
}

# å¯ç”¨
sudo ln -s /etc/nginx/sites-available/zhihu-hot /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl restart nginx
```

### ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²å‰ç«¯ï¼ˆ2åˆ†é’Ÿï¼‰

#### 1. æ„å»ºå‰ç«¯
```bash
cd first_page
npm install
npm run build
```

#### 2. ä¸Šä¼ åˆ° GitHub Pages
```bash
# æ–¹æ³• A: ä½¿ç”¨ gh-pages
npm run deploy

# æ–¹æ³• B: æ‰‹åŠ¨ä¸Šä¼  dist/ åˆ° GitHub Pages
```

#### 3. æˆ–ç›´æ¥è®¿é—®æœ¬åœ°å¼€å‘
```bash
npm run dev
# è®¿é—® http://localhost:5173
```

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®å‰ç«¯ï¼ˆ1åˆ†é’Ÿï¼‰

1. è®¿é—®å‰ç«¯é¡µé¢
2. åœ¨é…ç½®é¢æ¿è¾“å…¥åç«¯åœ°å€ï¼š
   ```
   http://your-server-ip:3000
   ```
   æˆ–ï¼ˆå¦‚æœé…ç½®äº†åŸŸåï¼‰ï¼š
   ```
   https://your-domain.com
   ```
3. ç‚¹å‡»"ä¿å­˜é…ç½®"
4. ç‚¹å‡»"æµ‹è¯•è¿æ¥"

### ç¬¬å››æ­¥ï¼šæµ‹è¯•åŠŸèƒ½ï¼ˆ2åˆ†é’Ÿï¼‰

1. **æ‰‹åŠ¨æŠ“å–**ï¼šç‚¹å‡»"æ‰‹åŠ¨æŠ“å–"æŒ‰é’®
2. **æŸ¥çœ‹æ•°æ®**ï¼šç­‰å¾… 2-3 ç§’ï¼ŒæŸ¥çœ‹çƒ­æ¦œæ•°æ®
3. **åŠ è½½å†å²**ï¼šç‚¹å‡»"ä»åç«¯åŠ è½½"
4. **æŸ¥çœ‹ç»Ÿè®¡**ï¼šç‚¹å‡»"ç»Ÿè®¡ä¿¡æ¯"

---

## ğŸ“Š å®Œæ•´æµç¨‹å›¾

```
éƒ¨ç½²åç«¯ (5åˆ†é’Ÿ)
  â†“
åç«¯å¯åŠ¨å¹¶ç›‘å¬ 3000 ç«¯å£
  â†“
é…ç½® Nginx åå‘ä»£ç† (å¯é€‰)
  â†“
éƒ¨ç½²å‰ç«¯åˆ° GitHub Pages (2åˆ†é’Ÿ)
  â†“
è®¿é—®å‰ç«¯é¡µé¢
  â†“
é…ç½®åç«¯åœ°å€
  â†“
æµ‹è¯•è¿æ¥
  â†“
å¼€å§‹ä½¿ç”¨ï¼
```

---

## ğŸ” éªŒè¯éƒ¨ç½²

### åç«¯æµ‹è¯•
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3000/api/health

# é¢„æœŸå“åº”ï¼š
{"status":"ok","timestamp":1704067200000,"version":"1.0.0"}
```

### å‰ç«¯æµ‹è¯•
1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`https://geeker-wang.github.io/first_page/`
2. é…ç½®åç«¯åœ°å€
3. ç‚¹å‡»"æ‰‹åŠ¨æŠ“å–"
4. åº”è¯¥çœ‹åˆ°çƒ­æ¦œæ•°æ®

---

## âš¡ å¸¸ç”¨å‘½ä»¤

### åç«¯ç®¡ç†
```bash
# PM2
pm2 status          # æŸ¥çœ‹çŠ¶æ€
pm2 logs zhihu-hot  # æŸ¥çœ‹æ—¥å¿—
pm2 restart zhihu-hot  # é‡å¯

# Docker
docker-compose ps   # æŸ¥çœ‹çŠ¶æ€
docker-compose logs # æŸ¥çœ‹æ—¥å¿—
docker-compose restart  # é‡å¯
```

### å‰ç«¯å¼€å‘
```bash
npm run dev         # å¼€å‘æœåŠ¡å™¨
npm run build       # ç”Ÿäº§æ„å»º
npm run type-check  # ç±»å‹æ£€æŸ¥
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½é€ŸæŸ¥

| åŠŸèƒ½ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| æ‰‹åŠ¨æŠ“å– | ç‚¹å‡»æŒ‰é’® | ç«‹å³æŠ“å–å¹¶ä¿å­˜ |
| åŠ è½½å†å² | ç‚¹å‡»æŒ‰é’® | ä»åç«¯è·å–å†å² |
| æŸ¥çœ‹æœ€æ–° | ç‚¹å‡»æŒ‰é’® | è·å–æœ€æ–°ä¸€æ¡ |
| ç»Ÿè®¡ä¿¡æ¯ | ç‚¹å‡»æŒ‰é’® | æŸ¥çœ‹æ•°æ®ç»Ÿè®¡ |
| è‡ªåŠ¨æŠ“å– | åç«¯å®šæ—¶ | æ¯30åˆ†é’Ÿè‡ªåŠ¨æ‰§è¡Œ |

---

## ğŸ“ æ•°æ®å­˜å‚¨

### åç«¯æ•°æ®åº“
```
backend/
  â””â”€â”€ data/
      â””â”€â”€ zhihu-hot.db    # SQLite æ•°æ®åº“
```

### æ•°æ®è¡¨ç»“æ„
- `hot_snapshots`: å¿«ç…§å…ƒæ•°æ®
- `hot_items`: çƒ­æ¦œæ¡ç›®è¯¦æƒ…

---

## ğŸ” å®‰å…¨é…ç½®

### 1. ç¯å¢ƒå˜é‡
```bash
# backend/.env
PORT=3000
CRON_SCHEDULE=0 */30 * * * *
ALLOWED_ORIGINS=https://your-frontend.com
```

### 2. CORS é™åˆ¶
åªå…è®¸æŒ‡å®šçš„å‰ç«¯åŸŸåè®¿é—®

### 3. API é™æµï¼ˆå¯é€‰ï¼‰
```javascript
// å®‰è£… express-rate-limit
npm install express-rate-limit
```

---

## ğŸ› å¸¸è§é—®é¢˜

**Q: åç«¯æ— æ³•è®¿é—®ï¼Ÿ**
A: æ£€æŸ¥é˜²ç«å¢™ç«¯å£ 3000 æ˜¯å¦å¼€æ”¾

**Q: å‰ç«¯è¿æ¥å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥ CORS é…ç½®å’Œåç«¯åœ°å€

**Q: å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œï¼Ÿ**
A: æ£€æŸ¥æœåŠ¡å™¨æ—¶é—´ï¼Œç¡®ä¿ PM2/Docker æ­£å¸¸è¿è¡Œ

**Q: æ•°æ®åº“é”™è¯¯ï¼Ÿ**
A: æ£€æŸ¥ data/ ç›®å½•æƒé™

---

## ğŸ“ è·å–å¸®åŠ©

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š
- `backend/README.md` - åç«¯æ–‡æ¡£
- `backend/DEPLOYMENT_GUIDE.md` - éƒ¨ç½²æŒ‡å—
- `ARCHITECTURE_V2.md` - æ¶æ„è¯´æ˜

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] åç«¯ä»£ç ä¸Šä¼ å®Œæˆ
- [ ] Node.js 18+ å·²å®‰è£…
- [ ] ä¾èµ–å·²å®‰è£… (npm install)
- [ ] .env é…ç½®å®Œæˆ
- [ ] ç«¯å£ 3000 å¼€æ”¾
- [ ] PM2/Docker å¯åŠ¨æˆåŠŸ
- [ ] å‰ç«¯æ„å»ºå®Œæˆ
- [ ] å‰ç«¯å·²éƒ¨ç½²
- [ ] é…ç½®åç«¯åœ°å€
- [ ] æµ‹è¯•è¿æ¥æˆåŠŸ
- [ ] æ‰‹åŠ¨æŠ“å–æµ‹è¯•
- [ ] æ•°æ®æ˜¾ç¤ºæ­£å¸¸

---

*ç‰ˆæœ¬: 2.0.0*
*æ›´æ–°æ—¶é—´: 2026-01-08*
