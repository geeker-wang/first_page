# 🔥 知乎热榜监控系统 - 使用指南

## 📋 功能概述

这是一个完整的 **知乎热榜监控系统**，基于 **Vue 3 + TypeScript + GitHub Pages** 构建，具备以下核心功能：

### ✅ 核心功能
1. **手动抓取** - 随时点击按钮抓取最新热榜
2. **自动抓取** - 定时自动抓取（可配置间隔）
3. **GitHub 存储** - 数据自动保存到 GitHub 仓库
4. **历史记录** - 查看所有历史快照
5. **数据查询** - 从本地/远程数据中查询历史热榜

## 🚀 快速开始

### 第一步：配置 GitHub 信息

1. 访问部署后的页面
2. 在 **配置面板** 中填写：
   - **GitHub 用户名**：你的 GitHub 用户名
   - **仓库名**：通常是 `first_page` 或你的项目仓库名
   - **GitHub Token**：需要 `repo` 权限的 Personal Access Token
   - **数据文件路径**：默认 `data/zhihu-hot.json`

### 第二步：生成 GitHub Token

1. 访问：https://github.com/settings/tokens
2. 点击 **Generate new token (classic)**
3. 设置权限：
   - ✅ `repo` - 完整仓库访问
   - ✅ `workflow` - 可选，用于触发 Actions
4. 生成并复制 Token

### 第三步：使用功能

#### 手动抓取
- 点击 **"手动抓取"** 按钮
- 数据会自动保存到 GitHub
- 显示在页面上并添加到历史记录

#### 自动抓取
1. 设置抓取间隔（默认 30 分钟）
2. 点击 **"启用自动抓取"**
3. 系统会定时抓取并保存数据
4. 显示下次抓取时间

#### 查看历史
- 在 **"历史快照"** 区域
- 点击任意快照查看详细内容
- 支持清空本地历史记录

## 📁 数据存储结构

### GitHub 数据文件格式
```json
[
  {
    "id": "snapshot-1704067200000",
    "timestamp": 1704067200000,
    "formattedTime": "2024-01-01 12:00:00",
    "count": 30,
    "items": [
      {
        "id": "123456",
        "title": "热榜标题",
        "description": "热榜描述",
        "heat": 1250000,
        "url": "https://www.zhihu.com/question/123456",
        "timestamp": 1704067200000,
        "fetchTime": "2024-01-01 12:00:00"
      }
    ]
  }
]
```

### 本地存储
- **配置信息**：`localStorage` 中的 `zhihu_config`
- **自动抓取状态**：`localStorage` 中的 `zhihu_auto_fetch`
- **间隔设置**：`localStorage` 中的 `zhihu_interval`

## 🔧 技术实现细节

### 1. 知乎爬取服务 (`src/services/zhihuCrawler.ts`)
- 使用 CORS 代理绕过跨域限制
- 支持真实 API 和模拟数据（API 不可用时）
- 自动转换数据格式
- 错误处理和重试机制

### 2. GitHub 存储服务 (`src/services/githubStorage.ts`)
- GitHub REST API 集成
- Base64 编码数据
- 自动更新文件（使用 SHA）
- 读写权限验证

### 3. 定时任务管理器 (`src/services/scheduler.ts`)
- 浏览器 `setInterval` 实现
- 自动执行抓取任务
- 状态管理（运行/停止）
- 下次抓取时间显示

### 4. 热榜组件 (`src/components/ZhihuHot.vue`)
- 完整的 UI 界面
- 配置管理
- 状态反馈
- 响应式设计

## ⚠️ 注意事项

### GitHub Token 安全
- Token **只保存在本地浏览器**中
- 不会上传到任何服务器
- 建议使用最小权限原则

### API 限制
- 知乎 API 可能有频率限制
- 使用 CORS 代理可能不稳定
- 提供模拟数据作为备选

### 数据同步
- 手动抓取时自动保存到 GitHub
- 从 GitHub 加载时会覆盖本地数据
- 建议定期手动备份

## 🐛 故障排除

### 问题：抓取失败
**解决方案**：
1. 检查网络连接
2. 等待 API 恢复
3. 系统会自动使用模拟数据

### 问题：GitHub 写入失败
**解决方案**：
1. 检查 Token 是否正确
2. 确认 Token 有 `repo` 权限
3. 检查仓库是否存在
4. 确认文件路径正确

### 问题：自动抓取不工作
**解决方案**：
1. 确保页面保持打开状态
2. 检查浏览器是否限制后台运行
3. 重新启用自动抓取

## 📊 页面结构

```
页面布局
├── 标题区域
│   └── 知乎热榜监控系统
├── 配置面板
│   ├── GitHub 用户名
│   ├── 仓库名
│   ├── GitHub Token
│   ├── 数据文件路径
│   └── 测试连接按钮
├── 控制面板
│   ├── 手动抓取按钮
│   ├── 自动抓取开关
│   ├── 从 GitHub 加载
│   └── 抓取间隔设置
├── 状态提示
│   ├── 成功/警告/错误信息
│   └── 下次抓取时间
├── 当前热榜
│   └── Top 30 实时数据
└── 历史快照
    └── 所有历史记录（可展开）
```

## 🎯 使用场景

### 场景 1：日常监控
- 启用自动抓取（30分钟间隔）
- 页面保持打开
- 定期查看热榜变化

### 场景 2：数据分析
- 手动抓取特定时间点数据
- 从 GitHub 加载历史记录
- 分析热榜趋势

### 场景 3：演示展示
- 配置 GitHub 信息
- 手动抓取展示功能
- 演示自动抓取流程

## 🔄 数据流程

```
1. 用户操作
   ↓
2. 触发抓取服务
   ↓
3. 调用知乎 API (通过 CORS 代理)
   ↓
4. 数据转换和验证
   ↓
5. 创建快照
   ↓
6. 保存到 GitHub
   ↓
7. 更新页面显示
   ↓
8. 添加到历史记录
```

## 📦 项目结构

```
src/
├── types/
│   └── zhihu.ts           # 类型定义
├── services/
│   ├── zhihuCrawler.ts    # 爬取服务
│   ├── githubStorage.ts   # GitHub 存储
│   └── scheduler.ts       # 定时任务
├── components/
│   └── ZhihuHot.vue       # 热榜组件
├── App.vue                # 主组件
├── main.ts                # 入口文件
└── env.d.ts               # 类型声明
```

## 🎉 总结

这个系统提供了一个完整的解决方案，用于：
- ✅ 实时监控知乎热榜
- ✅ 自动化数据收集
- ✅ 云端数据存储
- ✅ 历史数据查询
- ✅ 完全基于 GitHub Pages 部署

所有数据都存储在您的 GitHub 仓库中，您可以随时访问、分析或导出这些数据！

---

**祝使用愉快！** 🚀
