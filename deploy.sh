#!/bin/bash

# GitHub Pages éƒ¨ç½²è„šæœ¬
# ä½¿ç”¨æ–¹æ³•: ./deploy.sh

echo "ğŸš€ å¼€å§‹éƒ¨ç½²åˆ° GitHub Pages..."

# æ£€æŸ¥æ˜¯å¦å®‰è£…äº† Node.js
if ! command -v node &> /dev/null; then
    echo "âŒ é”™è¯¯: è¯·å…ˆå®‰è£… Node.js"
    exit 1
fi

# æ£€æŸ¥æ˜¯å¦å®‰è£…äº† npm
if ! command -v npm &> /dev/null; then
    echo "âŒ é”™è¯¯: è¯·å…ˆå®‰è£… npm"
    exit 1
fi

echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
npm install

echo "ğŸ”¨ æ„å»ºé¡¹ç›®..."
npm run build

# æ£€æŸ¥æ„å»ºæ˜¯å¦æˆåŠŸ
if [ ! -d "dist" ]; then
    echo "âŒ é”™è¯¯: æ„å»ºå¤±è´¥ï¼Œdist ç›®å½•ä¸å­˜åœ¨"
    exit 1
fi

echo "âœ… æ„å»ºæˆåŠŸï¼"

# æ£€æŸ¥æ˜¯å¦å®‰è£…äº† gh-pages
if ! npm list -g gh-pages &> /dev/null && ! npm list gh-pages &> /dev/null; then
    echo "ğŸ“¥ å®‰è£… gh-pages..."
    npm install gh-pages --save-dev
fi

echo "ğŸ“¤ éƒ¨ç½²åˆ° GitHub Pages..."
npx gh-pages -d dist

if [ $? -eq 0 ]; then
    echo "ğŸ‰ éƒ¨ç½²æˆåŠŸï¼"
    echo "ğŸ“± è®¿é—®: https://geeker-wang.github.io/first_page/"
else
    echo "âŒ éƒ¨ç½²å¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯"
    exit 1
fi